---
title: "Report Exercise 2"
output: html_document
date: "2023-03-07"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Loading Data and redefining variable
I load the packages that are necessary for this report exercise.

The .csv file was cleaned by hand. I removed all the unnecessary data.

With the read_csv2() command I was able to load the .csv document, which was using semicolons as a delimiter. After reviewing it, the variable "time" had to be changed from character to numeric, since we will have to work with that later on. With the command is.numeric I check if the change worked and if the veriable time is now numeric.

```{r read data}

library(tidyverse)
library(readr)
library(dplyr)

experiment_data <- read_csv2("data/1249534_S1_tidy.csv")
experiment_data_subset <- head(experiment_data, n = 3)
experiment_data_subset

experiment_data <- experiment_data %>% mutate(time = as.numeric(time))
is.numeric(experiment_data$time)


grouped_data <- group_by(experiment_data, experiment)
grouped_data

#We now have the data grouped into the differnet 53 experiments

```


## Calculate log-response-ratio 

Now the log response from each row in the csv file can be calulated and added to the file with the mutate() command. But this is not what we want. We want to have one log-response-ratio for each experiment, so a total of only 53 log-response-ratios. This can be calculated usung the summarize() command and this summarizing the rows of each experiment, then calculating the mean log-response-ratio, which is what we are looking for

```{r}
grouped_data_RR <- mutate(grouped_data, RR = log(co2_increased_mean / co2_ambient_mean))
grouped_data_RR

summary_data <- summarize(grouped_data_RR, mean_log_ratio = mean(log(co2_increased_mean / co2_ambient_mean)))
knitr::kable(summary_data)
```

## Aggregtae data into three times phases

Now we aggregate the data across all experiments and split it up into three time phases:
- early phase (<3 years since start)
- middle phase (3-6 years since start)
- late phase (>6 years since start)

Then the log-response-ratio can be calculated again, the file is now named experiment_data_RR.

```{r}
experiment_data_RR <- mutate(experiment_data, RR = log(co2_increased_mean / co2_ambient_mean))
experiment_data_RR
```

##Creating phase column

By creating a column named "Phase" I can group the data by years. There are three phases named "Early, Mid, Late". It is done with the cut() command, taking the column time and making breaks at 0,3,6, and Infinity. Then labeling them as Early, Mid and Late. This way I can later take the mean log-ratio from each phase, and what I am left with are three log-response-ratios, one from each Phase. I show the first three rows of the dataset after applying the cut() command to show what it looks like, you can see, the last column is now "Phase" with the first three experiments being part of the early phase.

```{r}
experiment_data_RR$Phase <- cut(experiment_data_RR$time, breaks = c(0, 3, 6, Inf), 
                       labels = c("Early", "Mid", "Late"), 
                       include.lowest = TRUE)
experiment_data_RR
experiment_data_RR_subset <- head(experiment_data_RR, n = 3)
knitr::kable(experiment_data_RR_subset)


mean_RR_by_phase <- tapply(experiment_data_RR$RR, experiment_data_RR$Phase, mean)
mean_RR_by_phase
```



####

